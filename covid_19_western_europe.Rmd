---
title: "COVID-19 in Switzerland and Western Europe"
output:
  html_document: 
    df_print: default
    number_sections: yes
    toc: yes
  html_notebook: 
    fig_height: 5
    fig_width: 7
    number_sections: yes
  word_document: 
    toc: yes
  pdf_document: default
date: "Last updated: `r format(Sys.time(), '%d %B, %Y - %H:%M')`"
author: "Philippe Docourt"
---

```{r, echo=FALSE, warning=FALSE}
library(data.table)

get_timeseries_as_vector <- function(df) {
  tmp <- subset(df, select = -c(Province.State, Lat, Long))
  tmp <- sapply(as.vector(transpose(tmp)), as.integer)
  return(tmp)
}

plot_time_sery_for_country <- function(country.confirmed, country.deaths, country.recovered, country.name, public.spaces.closed.at=NA, confinement.at=NA) {
    day.count <- nrow(country.confirmed)
  ylim <- c(0, 1.3 * max(country.confirmed, na.rm = TRUE))
  day.start <- min(c(35, public.spaces.closed.at, confinement.at), na.rm = TRUE)
  plot(country.confirmed, main= paste("Cases in", country.name), type = "o", xlab = "Days Since 2020-01-21", ylab = "Number of Cases", col = "red", xlim =  c(day.start, day.count + 4), ylim = ylim)
  lines(seq(1, length(country.deaths)), country.deaths, type = "l", col = "black", lty = 1, lw = 1)
  lines(seq(1, length(country.recovered)), country.recovered, type = "l", col = "green", lty = 1, lw = 1)
  grid()
  axis(side = 1, at = seq(day.start %/% 5 * 5, day.count, 5))
  
  # Trend based on last two observations.
  last.confirmed <- tail(country.confirmed, n = 2)
  dy <-last.confirmed[2] - last.confirmed[1]
  slope <- dy
  u <- c(1, dy)
  a <- last.confirmed[1] - (day.count - 1) * slope
  abline(a = a, b = slope, col = "violet", lw = 1.5, lty = 4)
  last.progression.pct <- round((100 * dy) / last.confirmed[1])
  text(x = day.count + 1, y = 0.65 * ylim[2], paste(dy, "cases/day\n", last.progression.pct, "% progress last day"), srt = 55, col = "violet")
  
  # Trend based on last 8 observations (7 intervals, one week)
  last.confirmed <- tail(country.confirmed, n = 8)
  dy <-last.confirmed[8] - last.confirmed[1]
  slope <- dy / 7
  u <- c(7, dy)
  a <- last.confirmed[1] - (day.count - 7) * slope
  abline(a = a, b = slope, col = "black", lw = 1.5, lty = 4)
  last.progression.pct <- round((100 * dy) / last.confirmed[1])
  text(x = day.count - 4, y = 0.7 * ylim[2], paste(dy, "cases/week\nAvg:", dy %/% 7, "case/day\n", last.progression.pct, "% progress last week"), srt = 55, col = "black")
  
  # Show special measures against propagation.
  ypos = max(country.confirmed, na.rm = TRUE) %/% 3
  if (!is.na(public.spaces.closed.at)) {
    abline(v = public.spaces.closed.at, col = "blue", lw = 1, lty = 5)
    text(x = public.spaces.closed.at - 0.05, y = ypos, "All public spaces\nare closed", col = "blue", srt = 90)
  }
  if (!is.na(confinement.at)) {
    abline(v = confinement.at, col = "red", lw = 1, lty = 5)
    text(x = confinement.at - 0.05, y = ypos, "Population\nis confined", col = "red", srt = 90)
  }
  
  legend("topleft", legend = c("Confirmed", "Deaths", "Recovered", "Confirmed cases trend based on last day", "Confirmed cases trend based on last week"), col = c("red", "black", "green", "violet", "black"), lty = c(rep(1, 3), 2, 3), lw = c(rep(1, 3), 1.5, 1.5))
}

covid <- read.csv("csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv")
covid.deaths <- read.csv("csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv")
covid.recovered <- read.csv("csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Recovered.csv")

countryNames <- c("Switzerland", "Italy", "France", "Germany", "Austria" , "Spain", "Great Britain", "Iceland")
country.count <- length(countryNames)
col <- rainbow(country.count)
lty <- seq(1, country.count)
pch <- seq(18, 18 + country.count)

switzerland.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "Switzerland"))
switzerland.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "Switzerland"))
switzerland.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "Switzerland"))

italy.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "Italy"))
italy.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "Italy"))
italy.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "Italy"))

france.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "France" & Province.State == "France"))
france.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "France" & Province.State == "France"))
france.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "France" & Province.State == "France"))

germany.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "Germany"))
germany.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "Germany"))
germany.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "Germany"))

austria.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "Austria"))
austria.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "Austria"))
austria.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "Austria"))

spain.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "Spain"))
spain.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "Spain"))
spain.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "Spain"))

uk.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "United Kingdom" & Province.State == "United Kingdom"))
uk.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "United Kingdom" & Province.State == "United Kingdom"))
uk.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "United Kingdom" & Province.State == "United Kingdom"))

iceland.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "Iceland"))
iceland.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "Iceland"))
iceland.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "Iceland"))

hubei.confirmed <- get_timeseries_as_vector(subset(covid, Country.Region == "China" & Province.State == "Hubei"))
hubei.deaths <- get_timeseries_as_vector(subset(covid.deaths, Country.Region == "China" & Province.State == "Hubei"))
hubei.recovered <- get_timeseries_as_vector(subset(covid.recovered, Country.Region == "China" & Province.State == "Hubei"))

day.count <- NROW(switzerland.confirmed)
```

# Evolution In Switzerland, Western Europe, and Hubei Province (China)

```{r, echo=FALSE}
plot_time_sery_for_country(switzerland.confirmed, switzerland.deaths, switzerland.recovered, "Switzerland", 55, NA)
plot_time_sery_for_country(italy.confirmed, italy.deaths, italy.recovered, "Italy", NA, 49)
plot_time_sery_for_country(france.confirmed, germany.deaths, france.recovered, "France", 53, 56)
plot_time_sery_for_country(germany.confirmed, switzerland.deaths, germany.recovered, "Germany", NA, 48)
plot_time_sery_for_country(austria.confirmed, austria.deaths, austria.recovered, "Austria", NA, 52)
plot_time_sery_for_country(spain.confirmed, spain.deaths, spain.recovered, "Spain", NA, 53)
plot_time_sery_for_country(uk.confirmed, uk.deaths, uk.recovered, "Great Britain", NA, NA)
plot_time_sery_for_country(iceland.confirmed, iceland.deaths, iceland.recovered, "Iceland", NA, NA)
plot_time_sery_for_country(hubei.confirmed, hubei.deaths, hubei.recovered, "Hubei Province, China", NA, 2)
```

# Comparison of Number of Confirmed Cases

```{r, echo=FALSE}
xrange <- c(35, day.count)
yrange <- c(0, 50000)

countries.confirmed <- list(switzerland.confirmed, italy.confirmed, france.confirmed, germany.confirmed, austria.confirmed, spain.confirmed, uk.confirmed, iceland.confirmed)
countries.deaths <- list(switzerland.deaths, italy.deaths, france.deaths, germany.deaths, austria.deaths, spain.deaths, uk.deaths, iceland.deaths)
countries.recovered <- list(switzerland.recovered, italy.recovered, france.recovered, germany.recovered, austria.recovered, spain.recovered, uk.recovered, iceland.recovered)

plot(xrange, yrange, main= "Confirmed Cases", type = "n", xlab = "Days Since 2020-01-20", ylab = "Number of Cases")
for (i in seq(1, country.count)) {
  lines(seq(1, day.count), countries.confirmed[[i]], type = "b", col = col[i], lty = lty[i], pch = pch[i], lw = 1)
}
grid()
legend("topleft", legend = countryNames, col = col, lty = lty, pch = pch, title = "Country")
```

# Comparison of Number of Deaths

```{r, echo=FALSE}
xrange <- c(40, day.count)
yrange <- c(0, 4500)
plot(xrange, yrange, main= "Deaths", type = "n", xlab = "Days Since 2020-01-20", ylab = "Number of Deaths")
for (i in seq(1, country.count)) {
  lines(seq(1, day.count), countries.deaths[[i]], type = "b", col = col[i], lty = lty[i], pch = pch[i], lw = 1)
}
grid()
legend("topleft", legend = countryNames, col = col, lty = lty, pch = pch, title = "Country")

```

# Comparison of Number of Recovered Cases

```{r, echo=FALSE}
xrange <- c(40, day.count)
yrange <- c(0, 5000)
plot(xrange, yrange, main= "Recovered Cases", type = "n", xlab = "Days Since 2020-01-20", ylab = "Number of Cases")
for (i in seq(1, country.count)) {
  lines(seq(1, day.count), countries.recovered[[i]], type = "b", col = col[i], lty = lty[i], pch = pch[i], lw = 1)
}
grid()
legend("topleft", legend = countryNames, col = col, lty = lty, pch = pch, title = "Country")
```

# Comparison of Number of Active Cases

```{r, echo=FALSE}
xrange <- c(40, day.count)
yrange <- c(0, 50000)
plot(xrange, yrange, main= "Active Cases", type = "n", xlab = "Days Since 2020-01-20", ylab = "Number of Cases")
for (i in seq(1, country.count)) {
  y <- countries.confirmed[[i]] - (countries.recovered[[i]] + countries.deaths[[i]])
  lines(seq(1, day.count), y, type = "b", col = col[i], lty = lty[i], pch = pch[i], lw = 1)
}
grid()
legend("topleft", legend = countryNames, col = col, lty = lty, pch = pch, title = "Country")
```

# About

All the graphs above are generated from the data provided by Johns Hopkins CSSE (provided to the public strictly for educational and academic research purposes).

The source code for generating the graphs is available under MIT License at https://github.com/philippe-docourt/COVID-19/blob/master/covid_19_western_europe.Rmd.

The data are provided as *2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by Johns Hopkins CSSE* (see https://github.com/CSSEGISandData/COVID-19).

See https://github.com/philippe-docourt/COVID-19/blob/master/README.md for more details.

## Data Sources

* World Health Organization (WHO): https://www.who.int/
* DXY.cn. Pneumonia. 2020. http://3g.dxy.cn/newh5/view/pneumonia.
* BNO News: https://bnonews.com/index.php/2020/02/the-latest-coronavirus-cases/
* National Health Commission of the People’s Republic of China (NHC):
* http://www.nhc.gov.cn/xcs/yqtb/list_gzbd.shtml
* China CDC (CCDC): http://weekly.chinacdc.cn/news/TrackingtheEpidemic.htm
* Hong Kong Department of Health: https://www.chp.gov.hk/en/features/102465.html
* Macau Government: https://www.ssm.gov.mo/portal/
* Taiwan CDC: https://sites.google.com/cdc.gov.tw/2019ncov/taiwan?authuser=0
* US CDC: https://www.cdc.gov/coronavirus/2019-ncov/index.html
* Government of Canada: https://www.canada.ca/en/public-health/services/diseases/coronavirus.html
* Australia Government Department of Health: https://www.health.gov.au/news/coronavirus-update-at-a-glance
* European Centre for Disease Prevention and Control (ECDC): https://www.ecdc.europa.eu/en/geographical-distribution-2019-ncov-cases
* Ministry of Health Singapore (MOH): https://www.moh.gov.sg/covid-19
* Italy Ministry of Health: http://www.salute.gov.it/nuovocoronavirus

## Terms of USe

* Data : Copyright 2020 Johns Hopkins University, all rights reserved. See https://github.com/CSSEGISandData/COVID-19/blob/master/README.md.
* Source code for generating graphs: Copyright Philippe Docourt. Licensed under MIT License. See https://github.com/philippe-docourt/COVID-19/blob/master/covid_19_western_europe.Rmd.
* Graphics : Public Domain

